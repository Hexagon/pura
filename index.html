<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrimShop - Image Editor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Top Toolbar -->
        <div class="toolbar">
            <div class="toolbar-section">
                <button class="tool-btn" id="newBtn" title="New Image">
                    <span>üìÑ</span>
                </button>
                <button class="tool-btn" id="openBtn" title="Open Image">
                    <span>üìÇ</span>
                </button>
                <button class="tool-btn" id="importLayerBtn" title="Import as Layer">
                    <span>üì•</span>
                </button>
                <button class="tool-btn" id="saveBtn" title="Save Image">
                    <span>üíæ</span>
                </button>
                <button class="tool-btn" id="imageDimensionsBtn" title="Image Dimensions">
                    <span>üìê</span>
                </button>
            </div>
            <div class="toolbar-section">
                <button class="tool-btn" id="undoBtn" title="Undo">
                    <span>‚Ü∂</span>
                </button>
                <button class="tool-btn" id="redoBtn" title="Redo">
                    <span>‚Ü∑</span>
                </button>
            </div>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar" id="tabBar">
            <div class="tab active" data-tab-id="start">
                <span class="tab-name">Start</span>
            </div>
        </div>

        <div class="main-content">
            <!-- Left Sidebar - Tools -->
            <div class="sidebar left-sidebar" id="leftSidebar">
                <button class="collapse-toggle" id="leftCollapseToggle">‚óÄ</button>
                
                <div class="panel-section">
                    <h3 class="panel-header" data-panel="tools">
                        <span class="panel-title">Tools</span>
                        <span class="panel-toggle">‚ñº</span>
                    </h3>
                    <div class="panel-content" id="toolsPanel">
                        <div class="tool-group">
                            <button class="tool-btn active" data-tool="pointer" title="Pointer (Select Layer)">
                                <span>‚ÜñÔ∏è</span>
                            </button>
                            <button class="tool-btn" data-tool="rectSelect" title="Rectangular Selection">
                                <span>üî≤</span>
                            </button>
                            <button class="tool-btn" data-tool="freeformSelect" title="Freeform Selection">
                                <span>‚úÇÔ∏è</span>
                            </button>
                            <button class="tool-btn" data-tool="move" title="Move Layer">
                                <span>‚úã</span>
                            </button>
                            <button class="tool-btn" data-tool="brush" title="Brush">
                                <span>üñåÔ∏è</span>
                            </button>
                            <button class="tool-btn" data-tool="eraser" title="Eraser">
                                <span>üßπ</span>
                            </button>
                            <button class="tool-btn" data-tool="fill" title="Fill">
                                <span>ü™£</span>
                            </button>
                            <button class="tool-btn" data-tool="gradient" title="Gradient">
                                <span>üåà</span>
                            </button>
                            <button class="tool-btn" data-tool="rect" title="Rectangle">
                                <span>‚¨ú</span>
                            </button>
                            <button class="tool-btn" data-tool="circle" title="Circle">
                                <span>‚≠ï</span>
                            </button>
                            <button class="tool-btn" data-tool="line" title="Line">
                                <span>üìè</span>
                            </button>
                            <button class="tool-btn" data-tool="text" title="Text">
                                <span>T</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3 class="panel-header" data-panel="toolOptions">
                        <span class="panel-title">Tool Options</span>
                        <span class="panel-toggle">‚ñº</span>
                    </h3>
                    <div class="panel-content" id="toolOptionsPanel">
                        <div class="tool-options-group" id="brushOptions" style="display: none;">
                            <label>Size: <span id="brushSizeValue">10</span>px</label>
                            <input type="range" id="brushSize" min="1" max="100" value="10">
                            <label>Opacity: <span id="opacityValue">100</span>%</label>
                            <input type="range" id="opacity" min="0" max="100" value="100">
                        </div>
                        <div class="tool-options-group" id="selectionOptions" style="display: none;">
                            <button class="tool-btn" id="selectAllBtn" title="Select All (Ctrl+A)">
                                <span>üìã</span>
                            </button>
                            <button class="tool-btn" id="deselectBtn" title="Deselect">
                                <span>‚úñÔ∏è</span>
                            </button>
                        </div>
                        <div class="tool-options-group" id="fillOptions" style="display: none;">
                            <label>Tolerance: <span id="fillToleranceValue">32</span></label>
                            <input type="range" id="fillTolerance" min="0" max="255" value="32">
                        </div>
                        <div class="tool-options-group" id="gradientOptions" style="display: none;">
                            <label>Type:</label>
                            <select id="gradientType">
                                <option value="linear">Linear</option>
                                <option value="radial">Radial</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3 class="panel-header" data-panel="color">
                        <span class="panel-title">Color</span>
                        <span class="panel-toggle">‚ñº</span>
                    </h3>
                    <div class="panel-content" id="colorPanel">
                        <div class="color-picker-group">
                            <label>Foreground:</label>
                            <input type="color" id="foregroundColor" value="#000000">
                            <label>Background:</label>
                            <input type="color" id="backgroundColor" value="#FFFFFF">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Canvas Area -->
            <div class="canvas-container">
                <!-- Start Screen -->
                <div id="startScreen" class="start-screen">
                    <div class="start-content">
                        <h1>CrimShop Image Editor</h1>
                        <p>Create a new image or open an existing one to get started</p>
                        <div class="start-actions">
                            <button class="start-btn" id="startNewBtn">
                                <span>üìÑ</span>
                                <div>
                                    <strong>New Image</strong>
                                    <small>Create a blank canvas</small>
                                </div>
                            </button>
                            <button class="start-btn" id="startOpenBtn">
                                <span>üìÇ</span>
                                <div>
                                    <strong>Open Image</strong>
                                    <small>Load an existing image</small>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Canvas Wrapper -->
                <div class="canvas-wrapper" id="canvasWrapper" style="display: none;">
                    <canvas id="mainCanvas"></canvas>
                </div>
            </div>

            <!-- Right Sidebar - Layers and Effects -->
            <div class="sidebar right-sidebar" id="rightSidebar">
                <button class="collapse-toggle" id="rightCollapseToggle">‚ñ∂</button>
                
                <div class="panel-section">
                    <h3 class="panel-header" data-panel="layers">
                        <span class="panel-title">Layers</span>
                        <span class="panel-toggle">‚ñº</span>
                    </h3>
                    <div class="panel-content" id="layersSection">
                        <div class="layers-panel" id="layersPanel">
                            <div class="layer-item active" data-layer-id="0">
                                <input type="checkbox" checked class="layer-visibility" data-layer-id="0">
                                <span class="layer-name">Background</span>
                                <button class="layer-delete" data-layer-id="0">√ó</button>
                            </div>
                        </div>
                        <div class="layer-controls">
                            <button class="tool-btn" id="addLayerBtn">+ Add Layer</button>
                            <button class="tool-btn" id="mergeLayersBtn">Merge Down</button>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="panel-header" data-panel="transforms">
                        <span class="panel-title">Transforms</span>
                        <span class="panel-toggle">‚ñº</span>
                    </h3>
                    <div class="panel-content" id="transformsPanel">
                        <div class="transform-controls">
                            <button class="tool-btn" id="resizeBtn">Resize</button>
                            <button class="tool-btn" id="rotateBtn">Rotate 90¬∞</button>
                            <button class="tool-btn" id="flipHBtn">Flip H</button>
                            <button class="tool-btn" id="flipVBtn">Flip V</button>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="panel-header" data-panel="effects">
                        <span class="panel-title">Effects</span>
                        <span class="panel-toggle">‚ñº</span>
                    </h3>
                    <div class="panel-content" id="effectsPanel">
                        <div class="effects-panel">
                            <button class="tool-btn" id="brightnessBtn">Brightness</button>
                            <button class="tool-btn" id="contrastBtn">Contrast</button>
                            <button class="tool-btn" id="grayscaleBtn">Grayscale</button>
                            <button class="tool-btn" id="invertBtn">Invert</button>
                            <button class="tool-btn" id="blurBtn">Blur</button>
                            <button class="tool-btn" id="sharpenBtn">Sharpen</button>
                        </div>
                    </div>
                </div>

                <div class="panel-section collapsed">
                    <h3 class="panel-header" data-panel="metadata">
                        <span class="panel-title">Metadata</span>
                        <span class="panel-toggle">‚ñº</span>
                    </h3>
                    <div class="panel-content" id="metadataPanel">
                        <div class="metadata-table">
                            <table id="metadataTable">
                                <tbody id="metadataTableBody">
                                    <!-- Metadata rows will be populated here -->
                                </tbody>
                            </table>
                            <button class="tool-btn" id="addMetadataFieldBtn" style="width: 100%; margin-top: 5px;">+ Add Field</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Input (Hidden) -->
    <input type="file" id="fileInput" accept="image/*" style="display: none;">
    <input type="file" id="importLayerInput" accept="image/*" style="display: none;">

    <!-- Modals -->
    <div id="newImageModal" class="modal">
        <div class="modal-content">
            <h2>New Image</h2>
            <label>Width: <input type="number" id="newWidth" value="800" min="1"></label>
            <label>Height: <input type="number" id="newHeight" value="600" min="1"></label>
            <label>Background: <input type="color" id="newBgColor" value="#FFFFFF"></label>
            <div class="modal-buttons">
                <button id="createNewBtn">Create</button>
                <button id="cancelNewBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="resizeModal" class="modal">
        <div class="modal-content">
            <h2>Resize Layer</h2>
            <label>Width: <input type="number" id="resizeWidth" min="1"></label>
            <label>Height: <input type="number" id="resizeHeight" min="1"></label>
            <label>
                <input type="checkbox" id="maintainAspect" checked>
                Maintain Aspect Ratio
            </label>
            <div class="modal-buttons">
                <button id="applyResizeBtn">Apply</button>
                <button id="cancelResizeBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="effectModal" class="modal">
        <div class="modal-content">
            <h2 id="effectTitle">Effect</h2>
            <label id="effectLabel">Amount: <span id="effectValue">50</span></label>
            <input type="range" id="effectSlider" min="0" max="100" value="50">
            <div class="modal-buttons">
                <button id="applyEffectBtn">Apply</button>
                <button id="cancelEffectBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="saveModal" class="modal">
        <div class="modal-content">
            <h2>Save Image</h2>
            <label>Format:
                <select id="saveFormat" style="width: 100%; padding: 8px; margin-top: 5px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #e0e0e0; border-radius: 4px;">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPEG</option>
                    <option value="webp">WebP</option>
                    <option value="gif">GIF</option>
                    <option value="apng">APNG (Animated PNG)</option>
                    <option value="tiff">TIFF</option>
                    <option value="bmp">BMP</option>
                    <option value="heic">HEIC</option>
                    <option value="avif">AVIF</option>
                </select>
            </label>
            <label id="qualityLabel" style="display: none;">Quality: <span id="qualityValue">90</span>
                <input type="range" id="saveQuality" min="0" max="100" value="90">
            </label>
            <label>
                <input type="checkbox" id="saveMultiFrame">
                Export as animation/multi-page (uses layer durations for GIF/APNG, pages for TIFF)
            </label>
            <label>Filename:
                <input type="text" id="saveFilename" value="crimshop-export" style="width: 100%; padding: 8px; margin-top: 5px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #e0e0e0; border-radius: 4px;">
            </label>
            <div class="modal-buttons">
                <button id="applySaveBtn">Save</button>
                <button id="cancelSaveBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="layerDurationModal" class="modal">
        <div class="modal-content">
            <h2>Set Layer Duration</h2>
            <label>Duration (milliseconds):
                <input type="number" id="layerDurationInput" value="100" min="10" step="10" style="width: 100%; padding: 8px; margin-top: 5px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #e0e0e0; border-radius: 4px;">
            </label>
            <p style="font-size: 12px; color: #888; margin-top: 10px;">Used for animated GIF/APNG export. Minimum: 10ms, Default: 100ms</p>
            <div class="modal-buttons">
                <button id="applyLayerDurationBtn">Apply</button>
                <button id="cancelLayerDurationBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="layerOpacityModal" class="modal">
        <div class="modal-content">
            <h2>Set Layer Opacity</h2>
            <label>Opacity: <span id="layerOpacityValue">100</span>%
                <input type="range" id="layerOpacityInput" min="0" max="100" value="100" step="1">
            </label>
            <div class="modal-buttons">
                <button id="applyLayerOpacityBtn">Apply</button>
                <button id="cancelLayerOpacityBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="imageDimensionsModal" class="modal">
        <div class="modal-content">
            <h2>Image Dimensions</h2>
            <label>Width: <input type="number" id="imageDimWidth" min="1"></label>
            <label>Height: <input type="number" id="imageDimHeight" min="1"></label>
            <label>
                <input type="checkbox" id="scaleAllLayers">
                Scale all layers when changing dimensions
            </label>
            <div class="modal-buttons">
                <button id="applyImageDimensionsBtn">Apply</button>
                <button id="cancelImageDimensionsBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="addMetadataFieldModal" class="modal">
        <div class="modal-content">
            <h2>Add Metadata Field</h2>
            <label>Field Name:
                <input type="text" id="newMetadataFieldName" placeholder="e.g., Keywords" style="width: 100%; padding: 8px; margin-top: 5px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #e0e0e0; border-radius: 4px;">
            </label>
            <div class="modal-buttons">
                <button id="applyAddMetadataFieldBtn">Add</button>
                <button id="cancelAddMetadataFieldBtn">Cancel</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
